<p-toast key="compacct-toast" baseZIndex="99999"></p-toast>
<p-toast position="center" baseZIndex="99999" key="c" (onClose)="onReject()" [modal]="true" [autoZIndex]="true">
    <ng-template let-message pTemplate="message">
        <div style="text-align: center">
            <i class="pi pi-exclamation-triangle" style="font-size: 3em"></i>
            <h3>{{message.summary}}</h3>
            <p>{{message.detail}}</p>
        </div>
        <div class="ui-g ui-fluid">
            <div class="ui-g-6">
                <button type="button" pButton (click)="onConfirm()" label="Yes" class="ui-button-success"></button>
            </div>
            <div class="ui-g-6">
                <button type="button" pButton (click)="onReject()" label="No" class="ui-button-secondary"></button>
            </div>
        </div>
    </ng-template>
</p-toast>

<div class="row">
    <div class="col-xs-12">
        <div class="box box-primary">
            <div class="form-horizontal">
                <div class="box-body">
                    <p-tabView [activeIndex]="tabIndexToView" (onChange)="TabClick($event)">
                        <p-tabPanel headerStyleClass="compacct-tabs" [header]="items[0]" leftIcon="glyphicon glyphicon-list-alt">
                            <div class="table-responsive no-padding">
                                <p-table #dt [value]="SearchedBrowselist"
                                    *ngIf="SearchedBrowselist.length"
                                    [globalFilterFields]="SearchedBrowselistHeader"
                                    [paginator]="true" [rows]="100" [rowHover]="true" [autoLayout]="true"
                                    sortMode="multiple" [rowsPerPageOptions]="[100,300,500]" [rowHover]="true">
                                    <ng-template pTemplate="caption">
                                        <div class="row">
                                            <div class="col-sm-3 pull-right" style="text-align: right;">
                                                <input type="text" pInputText size="50" placeholder="Search"
                                                    (input)="dt.filterGlobal($event.target.value, 'contains')"
                                                    class="searchInput form-control">
                                            </div>
                                        </div>

                                    </ng-template>
                                    <ng-template pTemplate="header">
                                        <tr>
                                            <th style="width:5em">Action</th>
                                            <th nowrap="nowrap" *ngFor="let option of SearchedBrowselistHeader">{{option.replaceAll('_',' ')}}</th> 

                                        </tr>
                                    </ng-template>
                                    <ng-template pTemplate="body" let-col>
                                        <tr>
                                            <td>
                                                <div class="dropdown">
                                                    <button class="btn btn-default btn-sm tableButton dropdown-toggle"
                                                        type="button" data-toggle="dropdown" style="height:27px">
                                                        <i class="fa fa-fw fa-bars"></i>
                                                        <span class="caret"></span>
                                                    </button>
                                                    <ul class="dropdown-menu">
                                                        <li *ngIf='col.Status.includes("CREATED")' >
                                                            <a (click)="getEdit(col)" >
                                                                <i class="fa fa-edit"></i> Edit
                                                            </a>
                                                        </li>
                                                        <li >
                                                            <a (click)="getView(col)" >
                                                                <i class="fa fa-info-circle"></i> View
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </td>
                                            <ng-container *ngFor="let option of SearchedBrowselistHeader ">
                                                <td *ngIf="option != 'Status'" >{{col[option]}}</td>
                                                <td *ngIf="option == 'Status'">
                                                    <ng-container *ngFor=" let statusdata of col[option].split(',')" >
                                                        <span [ngClass]="'badge bg-'+ getStatusWiseColor(statusdata)" >{{statusdata}}</span>
                                                    </ng-container>
                                                 </td>
                                            </ng-container>
                                        </tr>
                                    </ng-template>                                 
                                </p-table>
                            </div>
                        </p-tabPanel>
                        <p-tabPanel headerStyleClass="compacct-tabs" [header]="items[1]" leftIcon="glyphicon glyphicon-floppy-save">
                            <form name="salereturnForms" #salereturnForms="ngForm" novalidate>
                                <div class="form-group">
                                    <div class="col-sm-4">
                                        <label class="control-label">Sales Executive<sup class="text-danger">*</sup></label>
                                        <p-dropdown [options]="ExecutiveList" 
                                                    [showClear]="true" 
                                                    name="Executive_Name" 
                                                    #Executive_Name="ngModel"
                                                    [(ngModel)]="objsaleReturn.Sales_Man_ID" 
                                                    [emptyFilterMessage]="' No Executive Name Found'" 
                                                    [filter]="true"
                                                    filterBy="label,value.name" 
                                                    [resetFilterOnHide]="true" 
                                                    [placeholder]="'Select Executive Name'" 
                                                    [virtualScroll]="true"
                                                    itemSize="30" 
                                                    [ngClass]="{'clearance': salereturnFormsSubmitted && Executive_Name.errors?.required}"
                                                    required 
                                                    [disabled]="SalereturnList.length? true : false" >
                                        </p-dropdown>
                                    </div>
                                    <div class="col-sm-4" >
                                        <label class="control-label">Date Of Return<sup class="text-danger">*</sup></label>
                                        <div class="input-group date">
                                            <div class="input-group-addon">
                                                <i class="fa fa-calendar"></i>
                                            </div>
                                            <input CompacctNepaliDatepicker id="Docdate" name="Docdate" #Docdate="ngModel" Class="form-control"
                                                (ngModelChange)="DocDate= $event" [(ngModel)]="DocDate"
                                                [ngClass]="{'clearance': salereturnFormsSubmitted && Docdate?.errors?.required}" 
                                                required 
                                                [attr.disabled]="SalereturnList.length? true : null"
                                           >                                      
                                        </div> 
                                    </div>
                                    <div class="col-sm-4" >
                                        <label class="control-label">Customar Name<sup class="text-danger">*</sup></label>
                                        <p-dropdown [options]="customarList" 
                                                    [showClear]="true" 
                                                    name="Customar" 
                                                    #Customar="ngModel"
                                                    [(ngModel)]="objsaleReturn.Sub_Ledger_ID" 
                                                    [emptyFilterMessage]="' No Customar Name Found'" 
                                                    [filter]="true"
                                                    filterBy="label,value.name" 
                                                    [resetFilterOnHide]="true" 
                                                    [placeholder]="'Select Customar Name'" 
                                                    [virtualScroll]="true"
                                                    itemSize="30" 
                                                    (onChange)="getProduct(objsaleReturn.Sub_Ledger_ID)"
                                                    [ngClass]="{'clearance': salereturnFormsSubmitted && Customar.errors?.required}"
                                                     required
                                                     [disabled]="SalereturnList.length? true : false"
                                                      >
                                                  
                                                    </p-dropdown>
                                    </div>
                                    </div>
                                </form>
                                <hr class="box boxboxDivide-primary" />
                                <form name="addSalereturnForms" #addSalereturnForms="ngForm" novalidate>
                                    <div class="form-group">
                                        <div class="col-sm-4">
                                            <label class="control-label">Product<sup class="text-danger">*</sup></label>
                                            <p-dropdown [options]="ProductList" 
                                                        [showClear]="true" 
                                                        [dropdownIcon]="dropdownIcon"
                                                        name="Product" 
                                                        #Product="ngModel"
                                                        [(ngModel)]="ObjaddSaleReturn.Product_ID" 
                                                        [emptyFilterMessage]="'No Product Found'" 
                                                        [filter]="true"
                                                        filterBy="label,value.name" 
                                                        [resetFilterOnHide]="true" 
                                                        [placeholder]="'Select Product'" 
                                                        [virtualScroll]="true"
                                                        itemSize="30" 
                                                        (onChange)="getProductDetalis(ObjaddSaleReturn.Product_ID)"
                                                        [ngClass]="{'clearance': addSalereturnFormsSubmitted && Product.errors?.required}"
                                                         required >
                                                      </p-dropdown>
                                        </div>
                                        <div class="col-sm-2">
                                          <label class="control-label">Qty<sup class="text-danger">*</sup></label>
                                                <div class="input-group">
                                                    <input class="form-control"
                                                    name="Qty"
                                                    #Qty="ngModel"
                                                    [(ngModel)]="ObjaddSaleReturn.Qty"
                                                    placeholder="Qty"
                                                    (ngModelChange)="calculatAmount()"
                                                    [CompacctDigitonly]="true"
                                                    [ngClass]="{'clearance': addSalereturnFormsSubmitted && Qty.errors?.required}"
                                                    required >
                                                    <span class="input-group-addon">{{ObjaddSaleReturn.UOM ? ObjaddSaleReturn.UOM: "UOM"}}</span>
                                                 </div>
                                        </div>
                                        <div class="col-sm-2">
                                            <label class="control-label">Rate<sup class="text-danger">*</sup></label>
                                            <input class="form-control"
                                            name="Rate"
                                            #Rate="ngModel"
                                            [(ngModel)]="ObjaddSaleReturn.Rate"
                                            (ngModelChange)="calculatAmount()"
                                            placeholder="Rate"
                                            [CompacctDigitonly]="true"
                                            [ngClass]="{'clearance': addSalereturnFormsSubmitted && Rate.errors?.required}"
                                            required >
                                        </div>
                                        <div class="col-sm-2">
                                            <label class="control-label">Tax Amount<sup class="text-danger">*</sup></label>
                                            <input class="form-control"
                                            name="Tax_Amount"
                                            #Tax_Amount="ngModel"
                                            [(ngModel)]="ObjaddSaleReturn.Tax_Amount"
                                            (ngModelChange)="calculatAmount()"
                                            placeholder="Tax Amount"
                                            [CompacctDigitonly]="true"
                                            [ngClass]="{'clearance': addSalereturnFormsSubmitted && Tax_Amount.errors?.required}"
                                            required >
                                        </div>
                                        <div class="col-sm-2">
                                            <label class="control-label">Amount<sup class="text-danger">*</sup></label>
                                           <div class="label-t" >{{ObjaddSaleReturn.Amount ? ObjaddSaleReturn.Amount : 0}}</div>
                                        </div>
                                    </div>
                                    <div class="form-group" >
                                        <div class="col-sm-3">
                                            <label class="control-label">Reason Of Return<sup class="text-danger">*</sup></label>
                                            <select
                                            class="form-control"
                                            name="Reason_Of_Return"
                                            #Reason_Of_Return="ngModel"
                                            [(ngModel)]="ObjaddSaleReturn.Reason_Of_Return"
                                            [ngClass]="{'clearance': addSalereturnFormsSubmitted && Reason_Of_Return.errors?.required}"
                                            required>
                                            <option [ngValue]="undefined">Select</option>
                                            <option  *ngFor="let option of ReasonReturnList"  [ngValue]="option.Reason" >{{option.Reason}}</option>
                                           </select>
                                        </div>
                                        <div class="col-sm-3">
                                            <label class="control-label">Condition Of Goods<sup class="text-danger">*</sup></label>
                                            <select
                                            class="form-control"
                                            name="Condition_Of_Goods"
                                            #Condition_Of_Goods="ngModel"
                                            [(ngModel)]="ObjaddSaleReturn.Condition_Of_Goods"
                                            [ngClass]="{'clearance': addSalereturnFormsSubmitted && Condition_Of_Goods.errors?.required}"
                                            required>
                                            <option [ngValue]="undefined">Select</option>
                                            <option *ngFor="let option of ConditionOfGoodsList" [ngValue]="option.Condition" >{{option.Condition}}</option>
                                           </select>
                                        </div>
                                        <div class="col-sm-3">
                                            <label class="control-label">Type of Return<sup class="text-danger">*</sup></label>
                                            <select
                                            class="form-control"
                                            name="Type_Of_Return"
                                            #Type_Of_Return="ngModel"
                                            [(ngModel)]="ObjaddSaleReturn.Type_Of_Return"
                                            [ngClass]="{'clearance': addSalereturnFormsSubmitted && Type_Of_Return.errors?.required}"
                                            required>
                                            <option [ngValue]="undefined">Select</option>
                                            <option *ngFor=" let option of TypeReturnList " [ngValue]="option.Return_Type" >{{option.Return_Type}}</option>
                                           </select>
                                        </div>
                                        <div class="col-sm-3">
                                            <label class="control-label">Return<sup class="text-danger">*</sup></label>
                                            <select
                                            class="form-control"
                                            name="Return_Text"
                                            #Return_Text="ngModel"
                                            [(ngModel)]="ObjaddSaleReturn.Return_Text"
                                            [ngClass]="{'clearance': addSalereturnFormsSubmitted && Return_Text.errors?.required}"
                                            required>
                                            <option [ngValue]="undefined">Select</option>
                                            <option [ngValue]="'Full'">Full</option>
                                            <option [ngValue]="'Partial'">Partial</option>
                                           </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                       <div class="col-sm-3">
                                            <label class="control-label">Against Challan No<sup class="text-danger">*</sup></label>
                                            <input class="form-control"
                                            name="Against_Challan_No"
                                            #Against_Challan_No="ngModel"
                                            [(ngModel)]="ObjaddSaleReturn.Against_Challan_No"
                                            placeholder="Against Challan No"
                                            [ngClass]="{'clearance': addSalereturnFormsSubmitted && Against_Challan_No.errors?.required}"
                                            required >
                                        </div>
                                        <div class="col-sm-3">
                                            <label class="control-label">Tax Invoice No<sup class="text-danger">*</sup></label>
                                            <input class="form-control"
                                            name="Tax_Invoice_No"
                                            #Tax_Invoice_No="ngModel"
                                            [(ngModel)]="ObjaddSaleReturn.Tax_Invoice_No"
                                            placeholder="Tax Invoice No"
                                            [ngClass]="{'clearance': addSalereturnFormsSubmitted && Tax_Invoice_No.errors?.required}"
                                            required >
                                        </div>
                                        <div class="col-sm-3" >
                                            <button class="btn btn-primary custombutton"
                                            (click)="addSalereturnList(salereturnForms.form.valid, addSalereturnForms.form.valid)" >
                                            <span  class="glyphicon glyphicon-plus"></span> Add
                                            </button>
                                        </div>
                                    </div>
                                </form>
                                     
                                <div class="container-fluid" *ngIf="SalereturnList.length" style="margin-top: 5px;padding-right: 0px; padding-left: 0px;" >
                                    <div class="panel panel-primary">
                                      <div class="panel-heading"></div>
                                      <div class="panel-body" style="overflow-y: auto; height: 500px;" >
                                        <ng-container *ngFor=" let objsale of SalereturnList; let i = index" >
                                            <div class="card" style="margin-top: 3px; border: 2px solid #007ad954; padding: 8px; box-shadow: 10px;box-shadow: 3px 2px lightblue;" >
                                                <div class="card-header" style="text-align: end;">
                                                    <span (click)="DeleteSalereturnListRow(i)" style="color: red; cursor: pointer;"  class="glyphicon glyphicon-remove"></span>
                                                  </div>
                                                <div class="card-body">
                                                    <div class="form-group">
                                                        <div class="col-sm-4">
                                                            <label class="control-label">Product<sup class="text-danger">*</sup></label>
                                                                <div class="label-t" >{{objsale.Product_Description ? objsale.Product_Description : '-'}}</div>
                                                        </div>
                                                        <div class="col-sm-2">
                                                            <label class="control-label">Qty<sup class="text-danger">*</sup></label>
                                                            <div class="input-group">
                                                               <div class="label-t" >{{objsale.Qty ? objsale.Qty : 0}}</div>
                                                                <span class="input-group-addon">{{ObjaddSaleReturn.UOM ? objsale.UOM: "UOM"}}</span>
                                                             </div>
                                                        </div>
                                                        <div class="col-sm-2">
                                                            <label class="control-label">Rate<sup class="text-danger">*</sup></label>
                                                         <div class="label-t" >{{objsale.Rate ? objsale.Rate : 0}}</div>
                                                        </div>
                                                        <div class="col-sm-2">
                                                            <label class="control-label">Tax Amount<sup class="text-danger">*</sup></label>
                                                            <div class="label-t" >{{objsale.Tax_Amount ? objsale.Tax_Amount : 0}}</div>
                                                        </div>
                                                        <div class="col-sm-2">
                                                            <label class="control-label">Amount<sup class="text-danger">*</sup></label>
                                                           <div class="label-t" >{{objsale.Amount ? objsale.Amount : 0}}</div>
                                                        </div>
                                                    </div>
                                                    <div class="form-group" >
                                                        <div class="col-sm-3">
                                                            <label class="control-label">Reason Of Return<sup class="text-danger">*</sup></label>
                                                            <div class="label-t" >{{objsale.Reason_Of_Return ? objsale.Reason_Of_Return : '-'}} </div>
                                                        </div>
                                                        <div class="col-sm-3">
                                                            <label class="control-label">Condition Of Goods<sup class="text-danger">*</sup></label>
                                                            <div class="label-t" >{{objsale.Condition_Of_Goods ? objsale.Condition_Of_Goods : '-'}} </div>
                                                        </div>
                                                        <div class="col-sm-3">
                                                            <label class="control-label">Type of Return<sup class="text-danger">*</sup></label>
                                                            <div class="label-t" >{{objsale.Type_Of_Return ? objsale.Type_Of_Return : '-'}} </div>
                                                        </div>
                                                        <div class="col-sm-3">
                                                            <label class="control-label">Return<sup class="text-danger">*</sup></label>
                                                            <div class="label-t" >{{objsale.Return_Text ? objsale.Return_Text : '-'}} </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        
                                                        <div class="col-sm-3">
                                                            <label class="control-label">Against Challan No<sup class="text-danger">*</sup></label>
                                                            <div class="label-t" >{{objsale.Against_Challan_No ? objsale.Against_Challan_No : '-'}} </div>
                                                        </div>
                                                        <div class="col-sm-3">
                                                            <label class="control-label">Tax Invoice No<sup class="text-danger">*</sup></label>
                                                            <div class="label-t" >{{objsale.Tax_Invoice_No ? objsale.Tax_Invoice_No : '-'}} </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </ng-container>
                                        
                                      </div>
                                    </div>
                                  </div>
                                  <div class="box-footer" *ngIf="SalereturnList.length" >
                                    <button class="btn btn-primary pull-right" type="button" (click)="Savesalereturn()" id="load" [disabled]="Spinner">
                                                    <p-progressSpinner *ngIf="Spinner" [style]="{width: '15px', height: '15px'}" strokeWidth="8"  animationDuration=".5s"></p-progressSpinner>
                                                <span *ngIf="!Spinner" class="glyphicon glyphicon-save"></span>{{buttonname}}
                                            </button>
                                </div>
                          </p-tabPanel>
                    </p-tabView>
                </div>
            </div>
        </div>
    </div>
</div>

<p-dialog [header]="'View'" [appendTo]="'body'" [visible]="viewModal" [closeOnEscape]="true"
    [closable]="false" [modal]="true" [responsive]="true" [style]="{ width: '80%', minWidth: '200px' }"
    style="text-align: center;" [minY]="70" [maximizable]="false" [baseZIndex]="10000">
    <div class="row">
        <div class="col-xs-12">
            <div class="box box-primary">
                <div class="form-horizontal">
                    <div class="box-body">
                        <div class="form-group">
                            <div class="col-sm-4">
                                <label class="control-label">Sales Executive<sup class="text-danger">*</sup></label>
                                <div class="label-t" >{{viewList.length ? viewList[0].Member_Name : '-'}}</div>
                               
                            </div>
                            <div class="col-sm-4" >
                                <label class="control-label">Date Of Return<sup class="text-danger">*</sup></label>
                                <div class="input-group date">
                                    <div class="input-group-addon">
                                        <i class="fa fa-calendar"></i>
                                    </div>
                                    <input CompacctNepaliDatepicker id="Docdatev" name="Docdatev" #Docdatev="ngModel" Class="form-control"
                                       [(ngModel)]="DocDate" disabled
                                   >                                      
                                </div> 
                            </div>
                            <div class="col-sm-4" >
                                <label class="control-label">Customar Name<sup class="text-danger">*</sup></label>
                                <div class="label-t" >{{viewList.length ? viewList[0].Sub_Ledger_Name : '-'}}</div>
                            </div>
                            </div>
                            <div class="container-fluid" style="margin-top: 5px;padding-right: 0px; padding-left: 0px;" >
                                <div class="panel panel-primary">
                                  <div class="panel-heading"></div>
                                  <div class="panel-body" style="overflow-y: auto; height: 500px;" >
                                    <ng-container *ngFor=" let objsale of viewList; let i = index" >
                                        <div class="card" style="margin-top: 3px; border: 2px solid #007ad954; padding: 8px; box-shadow: 10px;box-shadow: 3px 2px lightblue;" >
                                            <div class="card-body">
                                                <div class="form-group">
                                                    <div class="col-sm-4">
                                                        <label class="control-label">Product<sup class="text-danger">*</sup></label>
                                                            <div class="label-t" >{{objsale.Product_Description ? objsale.Product_Description : '-'}}</div>
                                                    </div>
                                                    <div class="col-sm-2">
                                                        <label class="control-label">Qty<sup class="text-danger">*</sup></label>
                                                        <div class="input-group">
                                                           <div class="label-t" >{{objsale.Qty ? objsale.Qty : 0}}</div>
                                                            <span class="input-group-addon">{{objsale.UOM ? objsale.UOM: "UOM"}}</span>
                                                         </div>
                                                    </div>
                                                    <div class="col-sm-2">
                                                        <label class="control-label">Rate<sup class="text-danger">*</sup></label>
                                                     <div class="label-t" >{{objsale.Rate ? objsale.Rate : 0}}</div>
                                                    </div>
                                                    <div class="col-sm-2">
                                                        <label class="control-label">Tax Amount<sup class="text-danger">*</sup></label>
                                                        <div class="label-t" >{{objsale.Tax_Amount ? objsale.Tax_Amount : 0}}</div>
                                                    </div>
                                                    <div class="col-sm-2">
                                                        <label class="control-label">Amount<sup class="text-danger">*</sup></label>
                                                       <div class="label-t" >{{objsale.Amount ? objsale.Amount : 0}}</div>
                                                    </div>
                                                </div>
                                                <div class="form-group" >
                                                    <div class="col-sm-3">
                                                        <label class="control-label">Reason Of Return<sup class="text-danger">*</sup></label>
                                                        <div class="label-t" >{{objsale.Reason_Of_Return ? objsale.Reason_Of_Return : '-'}} </div>
                                                    </div>
                                                    <div class="col-sm-3">
                                                        <label class="control-label">Condition Of Goods<sup class="text-danger">*</sup></label>
                                                        <div class="label-t" >{{objsale.Condition_Of_Goods ? objsale.Condition_Of_Goods : '-'}} </div>
                                                    </div>
                                                    <div class="col-sm-3">
                                                        <label class="control-label">Type of Return<sup class="text-danger">*</sup></label>
                                                        <div class="label-t" >{{objsale.Type_Of_Return ? objsale.Type_Of_Return : '-'}} </div>
                                                    </div>
                                                    <div class="col-sm-3">
                                                        <label class="control-label">Return<sup class="text-danger">*</sup></label>
                                                        <div class="label-t" >{{objsale.Return_Text ? objsale.Return_Text : '-'}} </div>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    
                                                    <div class="col-sm-3">
                                                        <label class="control-label">Against Challan No<sup class="text-danger">*</sup></label>
                                                        <div class="label-t" >{{objsale.Against_Challan_No ? objsale.Against_Challan_No : '-'}} </div>
                                                    </div>
                                                    <div class="col-sm-3">
                                                        <label class="control-label">Tax Invoice No<sup class="text-danger">*</sup></label>
                                                        <div class="label-t" >{{objsale.Tax_Invoice_No ? objsale.Tax_Invoice_No : '-'}} </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </ng-container>
                                    
                                  </div>
                                </div>
                              </div>  
                    </div>
                </div>
            </div>
        </div>
    </div>
    <p-footer>
        <button type="button" (click)="viewModal = false" class="btn btn-info">
            Close
        </button>
    </p-footer>
</p-dialog>