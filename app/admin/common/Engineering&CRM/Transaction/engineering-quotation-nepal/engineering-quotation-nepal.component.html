<p-toast key="compacct-toast" baseZIndex="99999">
</p-toast>


<div class="row">
    <div class="col-xs-12">
        <div class="box box-primary">
            <div class="form-horizontal">
                <div class="box-body">
                    <p-tabView [activeIndex]="tabIndexToView" (onChange)="TabClick($event)">
                        <p-tabPanel headerStyleClass="compacct-tabs" [header]="items[0]" leftIcon="glyphicon glyphicon-list-alt">
                            <!-- <form name="SearchForm" #SearchForm="ngForm" novalidate>
                                <div class="form-group">
                                    <div class="col-sm-4">
                                        <label class="control-label">From Date <sup class="text-danger">*</sup></label>
                                        <div class="input-group date">
                                            <div class="input-group-addon">
                                                <i class="fa fa-calendar"></i>
                                            </div>
                                            <np-datepicker language="en"  id='BSdate' name="BSdate" inputClass="form-control" [(ngModel)]="BrowseStartDate"></np-datepicker>
                                        </div>
                                    </div>
                                    <div class="col-sm-4">
                                        <label class="control-label">To Date <sup class="text-danger">*</sup></label>
                                        <div class="input-group date">
                                            <div class="input-group-addon">
                                                <i class="fa fa-calendar"></i>
                                            </div>
                                            <np-datepicker language="en"  id='BEdate' name="BEdate" inputClass="form-control" [(ngModel)]="BrowseEndDate"></np-datepicker>
                                        </div>
                                    </div>
                                
                                    <div class="col-sm-3">
                                        <button class="btn btn-primary custombutton1" data-toggle="modal" (click)="GetSearchedList(SearchForm.form.valid)" id="load" [disabled]="seachSpinner">
                        <p-progressSpinner
                          *ngIf="seachSpinner"
                          [style]="{ width: '15px', height: '15px' }"
                          strokeWidth="8"
                          animationDuration=".5s"
                        ></p-progressSpinner>
                        <span
                          *ngIf="!seachSpinner"
                          class="glyphicon glyphicon-search"
                        ></span
                        >&nbsp;Search
                      </button>
                                    </div>
                                </div>

                            </form>
                            <div class="row">
                                <div class="col-sm-8">
                                    <h5><strong></strong></h5>
                                </div>
                            </div>
                            <div class="table-responsive no-padding productTable">
                                <p-table #dt [value]="BrowseList" [globalFilterFields]="['Location_Name','Mfg_Company','Machine','Serial_No','Service_Type','Service_Start_Date','Service_End_Date','Payment_Status','Payment_Date']" [paginator]="BrowseList.length ? true:false" [rows]="10"
                                    [rowHover]="true" [autoLayout]="true" sortMode="multiple" [rowsPerPageOptions]="[100,300,500]" [rowHover]="true">
                                    <ng-template pTemplate="caption">
                                        <div class="row">
                                            <div class="col-sm-3 pull-right" style="text-align: right;">
                                                <input type="text" pInputText size="50" placeholder="Search" (input)="dt.filterGlobal($event.target.value, 'contains')" class="searchInput form-control">
                                            </div>
                                        </div>

                                    </ng-template>
                                    <ng-template pTemplate="header">
                                        <tr>
                                            <th style="width:5em">Action</th>
                                            <th>Support Ticket No</th>
                                            <th>Support Ticket Date</th>
                                            <th>Call Type</th>
                                            <th>Customer Name</th>
                                            <th>Location</th>
                                            <th>Machine Make</th>
                                            <th>Machine</th>
                                            <th>Machine Serial No</th>
                                            <th>Engineer</th>
                                            <th>Contract Status</th>
                                            <th>Remarks</th>
                                        </tr>
                                    </ng-template>
                                    <ng-template pTemplate="body" let-col>
                                        <tr>

                                            <td>
                                                <div class="dropdown">
                                                    <button class="btn btn-default btn-sm tableButton dropdown-toggle" type="button" data-toggle="dropdown" style="height:27px">
                                                                                <i class="fa fa-fw fa-bars"></i>
                                                                                <span class="caret"></span>
                                                                            </button>
                                                    <ul class="dropdown-menu">
                                                        <li>
                                                            <a (click)="Edit(col)">
                                                                <i class="fa fa-fw fa-pencil"></i> Edit
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </td>
                                            <td>{{col.Support_Ticket_No}}</td>
                                            <td>{{col.Support_Ticket_Date}}</td>
                                            <td>{{col.Call_Type}}</td>
                                            <td>{{col.Sub_Ledger_Name}}</td>
                                            <td>{{col.Location_Name}}</td>
                                            <td>{{col.Mfg_Company}}</td>
                                            <td>{{col.Machine}}</td>
                                            <td>{{col.Serial_No}}</td>
                                            <td>{{col.Member_Name}}</td>
                                            <td>{{col.Contract_Status}}</td>
                                            <td>{{col.Remarks}}</td>
                                        </tr>
                                    </ng-template>
                                    <ng-template pTemplate="paginatorright" let-state>
                                        Showing {{state.first+1}} of {{(state.first+1) + state.rows}} of {{state.totalRecords}}
                                    </ng-template>
                                </p-table>
                            </div> -->
                        </p-tabPanel>
                        <p-tabPanel headerStyleClass="compacct-tabs" [header]="items[1]" leftIcon="glyphicon glyphicon-floppy-save">
                            <form name="EnginnerQuoationForm" #EnginnerQuoationForm="ngForm" novalidate>
                                <div class="form-group">
                                    <div class="col-sm-4">
                                        <label class="control-label">Customer&nbsp;<span class="text-danger">*</span></label>
                                        <p-dropdown [options]="CustomerList"
                                                    name="Customer"
                                                    [(ngModel)]="ObjEnginnerQuoation.Sub_Ledger_ID"
                                                    [showClear]="true"
                                                    [emptyFilterMessage]="' No Customer Found'"
                                                    (onChange)="GetLocation()"
                                                    [filter]="true"
                                                    filterBy="label,value.name"
                                                    [placeholder]="'Select Customer'"
                                                    [virtualScroll]="true"
                                                    itemSize="30"
                                                    #Customer="ngModel"
                                                    [disabled]="EngQuoationProductList.length"
                                                    [styleClass]="EnginnerQuoationFormSubmitted &&  Customer.errors?.required ? 'clearance' :''"
                                                    [required]="true">
                                                </p-dropdown>
                                    </div>
                                    <div class="col-sm-4">
                                        <label class="control-label">Quoation Date <sup class="text-danger">*</sup></label>
                                        <div class="input-group date">
                                            <div class="input-group-addon">
                                                <i class="fa fa-calendar"></i>
                                            </div>
                                            
                                            <input  CompacctNepaliDatepicker id="Quoation" name="Quoation"
                                             Class="form-control" (ngModelChange)="QuoationDate= $event"
                                             [disabled]="EngQuoationProductList.length"
                                             [(ngModel)]="QuoationDate"/>
                                            <!-- <np-datepicker language="en"  id='Quoation' 
                                            [disabled]="EngQuoationProductList.length"
                                            name="Quoation" inputClass="form-control" [(ngModel)]="QuoationDate"></np-datepicker> -->
                                        </div>
                                    </div>
                                </div>
                            </form>
                            <hr class="box boxboxDivide-primary">
                            <form name="EnginnerQuoationMachineForm" #EnginnerQuoationMachineForm="ngForm" novalidate>
                                <div class="form-group">
                                    <div class="col-sm-4">
                                        <label class="control-label">Location<sup class="text-danger">*</sup></label>
                                        <select class="form-control" name="location" #location="ngModel"
                                         [(ngModel)]="ObjEnginnerQuoation.Location_ID"
                                          (change)="GetManufactureList()"
                                         [ngClass]="{'clearance': EnginnerQuoationMachineFormSubmitted && location.errors?.required}"
                                          required>
                                                              <option  [ngValue]="undefined">Select</option>
                                                          <option *ngFor="let option of LoctionList" [ngValue]="option.Location_ID">
                                                              {{option.Location_Name}}
                                                              </option>
                                                      </select>
                                    </div>
                                    <div class="col-sm-4">
                                        <label class="control-label">Manufacture&nbsp;<span class="text-danger">*</span></label>
                                        <p-dropdown [options]="ManufactureList"
                                                    name="Manufacture"
                                                    [(ngModel)]="ObjEnginnerQuoation.Product_Mfg_Comp_ID"
                                                    [showClear]="true"
                                                    [emptyFilterMessage]="' No Manufacture Found'"
                                                    (onChange)="GetInstallMachine()"
                                                    [filter]="true"
                                                    filterBy="label,value.name"
                                                    [placeholder]="'Select Manufacture'"
                                                    [virtualScroll]="true"
                                                    itemSize="30"
                                                    #Manufacture="ngModel"
                                                    [styleClass]="EnginnerQuoationMachineFormSubmitted &&  Manufacture.errors?.required ? 'clearance' :''"
                                                    [required]="true">
                                                </p-dropdown>
                                    </div>
                                    <div class="col-sm-4">
                                        <label class="control-label">Installed Machine&nbsp;<span class="text-danger">*</span></label>
                                        <p-dropdown [options]="InstallMachineList"
                                                    name="Installed"
                                                    [(ngModel)]="ObjEnginnerQuoation.Product_ID"
                                                    [showClear]="true"
                                                    [emptyFilterMessage]="' No Installed Machine Found'"
                                                    (onChange)="ProductChange()"
                                                    [filter]="true"
                                                    filterBy="label,value.name"
                                                    [placeholder]="'Select Installed Machine'"
                                                    [virtualScroll]="true"
                                                    itemSize="30"
                                                    #Installed="ngModel"
                                                    [styleClass]="EnginnerQuoationMachineFormSubmitted &&  Installed.errors?.required ? 'clearance' :''"
                                                    [required]="true">
                                                </p-dropdown>
                                    </div>
                                    <div class="col-sm-4" style="margin-top: -2px;">
                                        <label class="control-label">Spare Parts&nbsp;<span class="text-danger">*</span></label>
                                        <p-dropdown [options]="SparePartsList"
                                                    name="Spare"
                                                    [(ngModel)]="ObjEnginnerQuoation.Spare_Parts_Product_ID"
                                                    [showClear]="true"
                                                    (onChange)="SparePartChange()"
                                                    [emptyFilterMessage]="'No Spare Parts Found'"
                                                    [filter]="true"
                                                    filterBy="label,value.name"
                                                    [placeholder]="'Select Spare Parts'"
                                                    [virtualScroll]="true"
                                                    itemSize="30"
                                                    #Spare="ngModel"
                                                    [styleClass]="EnginnerQuoationMachineFormSubmitted &&  Spare.errors?.required ? 'clearance' :''"
                                                    [required]="true">
                                                </p-dropdown>
                                    </div>
                                    <div class="col-sm-2">
                                        <label class="control-label">Quantity<sup class="text-danger">*</sup></label>
                                        <input class="form-control" name="qty"
                                                #qty="ngModel"
                                                [(ngModel)]="ObjEnginnerQuoation.Qty"
                                                (change)="CalculateAmount()"
                                                [ngClass]="{'clearance': EnginnerQuoationMachineFormSubmitted && qty?.errors?.required }"
                                                [required]="true"
                                                CompacctDigitonly="true"
                                                placeholder="Quantity" />
                                    </div>
                                    <div class="col-sm-2">
                                        <label class="control-label">Rate<sup class="text-danger">*</sup></label>
                                        <input class="form-control" name="rate"
                                                type="text"
                                                [ngClass]="{'clearance': EnginnerQuoationMachineFormSubmitted &&  rate?.errors?.required }"
                                                #rate="ngModel"
                                                [(ngModel)]="ObjEnginnerQuoation.Rate"
                                                (change)="CalculateAmount()"
                                                CompacctDigitonly="true"
                                                [required]="true"
                                                placeholder="Rate" />
                                    </div>
                                    <div class="col-sm-2">
                                        <label class="control-label">Total Amount<sup class="text-danger">*</sup></label>
                                        <input class="form-control" name="tolamt"
                                                #tolamt="ngModel"
                                                [(ngModel)]="ObjEnginnerQuoation.Amount"
                                                [disabled]="true"
                                                placeholder="Total Amount" />
                                    </div>
                                    <div class="col-sm-2">
                                        <label class="control-label">Discount Type<sup class="text-danger"></sup></label>
                                        <select name="distype"
                                                #distype="ngModel"
                                                [(ngModel)]="ObjEnginnerQuoation.Discount_Type"
                                                class="form-control"
                                                (change)="DiscountTypeClean()">
                                            <option  [ngValue]="undefined">Select</option>
                                            <option value="%"> %</option>
                                            <option value="AMT"> AMT</option>
                                        </select>
                                    </div>
                                    <div class="col-sm-2">
                                        <label class="control-label">Discount<sup class="text-danger"></sup></label>
                                        <input class="form-control" name="Discount"
                                                #Discount="ngModel"
                                                [(ngModel)]="ObjEnginnerQuoation.Discount"
                                                (change)="DiscountTypeChange()"
                                                CompacctDigitonly="true"
                                                placeholder="Discount" />
                                    </div>
                                    <div class="col-sm-2">
                                        <label class="control-label">Discount Amount<sup class="text-danger"></sup></label>
                                        <input class="form-control" name="DisAmt"
                                                #DisAmt="ngModel"
                                                [(ngModel)]="ObjEnginnerQuoation.Discount_Type_Amount"
                                                [disabled]="true"
                                                placeholder="Discount Amount" />
                                    </div>
                                    <div class="col-sm-3">
                                        <label class="control-label">VAT %<sup class="text-danger"></sup></label>
                                        <div class="input-group">
                                            <input class="form-control" name="VAT"
                                                #VAT="ngModel"
                                                [(ngModel)]="ObjEnginnerQuoation.Vat_Tax"
                                                (change)="CalculateTax()"
                                                placeholder="VAT %" 
                                                CompacctDigitonly="true"/>
                                            <div class="input-group-addon">
                                               %
                                            </div>
                                        </div>
                                        
                                    </div>
                                    <div class="col-sm-2">
                                        <label class="control-label">Taxable Amount<sup class="text-danger"></sup></label>
                                        <input class="form-control" name="TaxableAmt"
                                                #TaxableAmt="ngModel"
                                                [(ngModel)]="ObjEnginnerQuoation.Net_Amt"
                                                [disabled]="true"
                                                placeholder="Taxable Amount" />
                                    </div>
                                    <div class="col-sm-3">
                                        <button type="submit"
                                                name='stock'
                                                class="btn btn-primary custombutton"
                                                (click)="AddProductInfo(EnginnerQuoationMachineForm.form.valid)">
                                            <span class="glyphicon glyphicon-plus"></span>&nbsp;Add
                                        </button>
                                    </div>
                                </div>
                            </form>
                            <div class="table-responsive no-padding" style="margin-top:2.5em;">
                                <table class="table bidopen table-bordered">
                                  <thead>
                                    <tr style="background-color:#3c8dbc;color:white;">
                                        <th class="text-center" style="vertical-align:middle">Sl No.</th> 
                                      <th class="text-center" style="vertical-align:middle">Location</th>                                      
                                      <th class="text-center" style="vertical-align:middle">Mfg Name</th>                                    
                                      <th class="text-center" style="vertical-align:middle">Machine Name</th>
                                      <th class="text-center" style="vertical-align:middle">Spare Parts</th>
                                      <th class="text-center" style="vertical-align:middle">Qty</th>
                                      <th class="text-center" style="vertical-align:middle">Rate</th>
                                      <th class="text-center" style="vertical-align:middle">Total Amount</th>
                                      <th class="text-center" style="vertical-align:middle">Disount Type</th>
                                      <th class="text-center" style="vertical-align:middle">Disount Amt</th>
                                      <th class="text-center" style="vertical-align:middle">Vat %</th>
                                      <th class="text-center" style="vertical-align:middle">Taxable Amt</th>
                                      <th class="text-center" style="vertical-align:middle">Delete</th>
                                    </tr>

                                  </thead>
                                  <tbody>
                                    <tr
                                      *ngFor="
                                        let d of EngQuoationProductList;
                                        let odd = odd;
                                        let index = index
                                      "
                                      [class.even]="odd"
                                    >
                                      <td>{{ index + 1 }}</td>
                                      <td>{{ d.Location_Name }}</td>
                                      <td>{{ d.Mfg_Company ? d.Mfg_Company : '-'  }}</td>
                                      <td>{{ d.Machine ? d.Machine : '-'  }}</td>
                                      <td>{{ d.Spare_Part_Description ? d.Spare_Part_Description : '-'  }}</td>
                                      <td>{{ d.Qty ? d.Qty : '-'  }}</td>
                                      <td>{{ d.Rate ? d.Rate : '-'  }}</td>
                                      <td>{{ d.Amount ? d.Amount : '-'  }}</td>
                                      <td>{{ d.Discount_Type ? d.Discount_Type : '-'  }}</td>
                                      <td>{{ d.Discount_Type_Amount ? d.Discount_Type_Amount : '-'  }}</td>
                                      <td>{{ d.Vat_Tax ? d.Vat_Tax : '-'  }}</td>
                                      <td>{{ d.Net_Amt ? d.Net_Amt : '-'  }}</td>
                                      <td>
                                        <a (click)="Delete(index)"
                                          ><div><i class="fa fa-fw fa-trash"> </i></div>
                                        </a>
                                      </td>
                                     
                                    </tr>
                                  </tbody>
                                </table>
                              </div>
                          
                            <!-- <div class="col-sm-6"> -->
                            <!-- <div class="box-footer">
                                <button class="btn btn-primary pull-right1" (click)="SaveSupportTicket(SupportTicketForm.form.valid)" id="load" [disabled]="Spinner">
                                                            <p-progressSpinner *ngIf="Spinner" [style]="{width: '15px', height: '15px'}" strokeWidth="8"  animationDuration=".5s"></p-progressSpinner>
                                                        <span *ngIf="!Spinner" class="glyphicon glyphicon-save"></span>{{buttonname}}
                                                    </button>
                            </div> -->
                            <!-- </div> -->
                        </p-tabPanel>
                    </p-tabView>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- SHOW PREVIOUS CONTRACT -->
<p-dialog header="Contract Details" [appendTo]="'body'" [visible]="PreviousContractPopup" [closeOnEscape]="true" [closable]="false" [modal]="true" [responsive]="true" [style]="{ width: '80%', minWidth: '300px' }" style="text-align: center;" [minY]="80"
    [maximizable]="true" [baseZIndex]="10000">
    <!-- <div class="clearfix"></div> -->
    <div class="table-responsive no-padding">
        <p-table [value]="previouscontractList" [globalFilterFields]='["Sub_Ledger_Name","Location_Name","Mfg_Company","Machine","Serial_No","Service_Type","Service_Start_Date","Service_End_Date","Payment_Status","Payment_Date"]' [rowHover]="true" [autoLayout]="true"
            #dt3>
            <ng-template pTemplate="caption">
                <div class="row">
                    <div class="col-sm-3 pull-right" style="text-align: right">
                        <input type="text" pInputText size="50" placeholder="Search" (input)="dt3.filterGlobal($event.target.value, 'contains')" class="searchInput form-control">
                    </div>
                </div>

            </ng-template>
            <ng-template pTemplate="header">
                <tr>
                    <th>Customer Name</th>
                    <th>Location</th>
                    <th>Manufacturer</th>
                    <th>Machine</th>
                    <th>Serial No</th>
                    <th>Type of Service</th>
                    <th>Service Start Date</th>
                    <th>Service End Date</th>
                    <th>Payment Status</th>
                    <th>Payment Date</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-col let-rowIndex="rowIndex">
                <tr>

                    <td>{{col.Sub_Ledger_Name}}</td>
                    <td>{{col.Location_Name}}</td>
                    <td>{{col.Mfg_Company}}</td>
                    <td>{{col.Machine}}</td>
                    <td>{{col.Serial_No}}</td>
                    <td>{{col.Service_Type}}</td>
                    <td>{{col.Service_Start_Date | date : 'dd/MMM/yyyy'}}</td>
                    <td>{{col.Service_End_Date | date : 'dd/MMM/yyyy'}}</td>
                    <td>{{col.Payment_Status}}</td>
                    <td>{{col.Payment_Date | date : 'dd/MMM/yyyy'}}</td>

                </tr>
            </ng-template>
        </p-table>
    </div>
    <p-footer>
        <button type="button" (click)="PreviousContractPopup = false" class="btn btn-default">
                                  CLOSE
                                </button>
    </p-footer>
</p-dialog>